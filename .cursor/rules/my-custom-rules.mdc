---
description: "Quy táº¯c phÃ¡t triá»ƒn dá»± Ã¡n Web Äá»c Truyá»‡n Tiá»‡m Truyá»‡n MÃ¨o BÃ©o"
globs:
  - "**/*.java"
  - "**/*.kt"
  - "**/*.md"
alwaysApply: true
---

# CURSOR INSTRUCTION â€“ WEB Äá»ŒC TRUYá»†N

## ğŸ” NgÃ´n ngá»¯ máº·c Ä‘á»‹nh:

- Táº¥t cáº£ cÃ¢u tráº£ lá»i, hÆ°á»›ng dáº«n, code vÃ  giáº£i thÃ­ch Ä‘á»u **báº±ng tiáº¿ng Viá»‡t**.
- Náº¿u ngÆ°á»i dÃ¹ng dÃ¹ng tiáº¿ng Anh hoáº·c yÃªu cáº§u xuáº¥t code tiáº¿ng Anh thÃ¬ má»›i chuyá»ƒn.

---

## ğŸ§¾ Khi yÃªu cáº§u cÃ³ ná»™i dung dÃ i:

- **KhÃ´ng tráº£ lá»i 1 cá»¥c dÃ i**.
- PhÃ¢n tÃ­ch yÃªu cáº§u thÃ nh **TODO list cá»¥ thá»ƒ**, vÃ­ dá»¥:
  - BÆ°á»›c 1: Thiáº¿t káº¿ API
  - BÆ°á»›c 2: Viáº¿t controller
  - BÆ°á»›c 3: Táº¡o entity vÃ  service
- Má»—i bÆ°á»›c tráº£ lá»i riÃªng, **giá»¯ tiáº¿n Ä‘á»™ rÃµ rÃ ng**, trÃ¡nh nháº£y cÃ³c.

---

## ğŸ› ï¸ Äá»‘i vá»›i Java Spring Boot:

- **KHÃ”NG sá»­ dá»¥ng `@Autowired` field injection.**
  - âœ… DÃ¹ng constructor injection cho má»i service, repository.
- Æ¯u tiÃªn **`@Service`, `@Repository`, `@Component` rÃµ rÃ ng**, khÃ´ng nhá»“i logic vÃ o controller.
- TuÃ¢n thá»§ mÃ´ hÃ¬nh **Clean Architecture** hoáº·c **Layered Architecture**:
  - `Controller` â†’ `Service` â†’ `Repository`
- Má»—i controller/service khÃ´ng nÃªn dÃ i quÃ¡ 300 dÃ²ng.
- KhÃ´ng hard-code string nhÆ° role hay status: nÃªn dÃ¹ng `enum` hoáº·c `constant`.

---

## ğŸ§¹ Code sáº¡ch vÃ  maintainable:

- Format code chuáº©n theo Java conventions (CamelCase, PascalCaseâ€¦).
- KhÃ´ng dÃ¹ng biáº¿n Ä‘áº·t tÃªn `a`, `b`, `temp` â€“ táº¥t cáº£ biáº¿n pháº£i cÃ³ Ã½ nghÄ©a.
- Comment khi cáº§n, KHÃ”NG comment thá»«a.
- Náº¿u cÃ³ Ä‘oáº¡n code phá»©c táº¡p â†’ giáº£i thÃ­ch rÃµ trong comment hoáº·c docstring.
- á» controller comment Ä‘á»ƒ biáº¿t API dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬ .
- Æ¯u tiÃªn viáº¿t code **Ä‘á»c Ä‘Æ°á»£c dá»… hÆ¡n lÃ  viáº¿t ngáº¯n**.

---

## ğŸ“Š JPA â€“ Query â€“ Index:

- Khi lÃ m viá»‡c vá»›i cÃ¡c báº£ng lá»›n nhÆ° `chapters`, `stories`, `reading_history`, `chapter_unlocks`â€¦:
  - âœ… LuÃ´n xÃ¡c Ä‘á»‹nh rÃµ truy váº¥n chÃ­nh Ä‘á»ƒ táº¡o **index phÃ¹ há»£p** trong PostgreSQL.
- Náº¿u dÃ¹ng JPA filter nhÆ°:
  - Lá»c chÆ°Æ¡ng theo `story_slug`, `chapter_number` â†’ dÃ¹ng composite index `(story_id, chapter_number)`
  - Kiá»ƒm tra unlock chÆ°Æ¡ng â†’ index `(user_id, chapter_id)`
  - Láº¥y truyá»‡n theo `slug` â†’ index `slug` UNIQUE
- Vá»›i truy váº¥n phá»©c táº¡p, Ä‘á»«ng láº¡m dá»¥ng `findByâ€¦` mÃ  dÃ¹ng `@Query` hoáº·c `QueryDSL` Ä‘á»ƒ:
  - JOIN chÃ­nh xÃ¡c
  - FETCH Ä‘á»ƒ trÃ¡nh lazy loading cháº­m
- Náº¿u phÃ¢n trang â†’ báº¯t buá»™c dÃ¹ng `Pageable`
- Náº¿u cáº§n tÃ¬m kiáº¿m nÃ¢ng cao (keyword, tag, tÃ¡c giáº£,â€¦) â†’ index FULLTEXT hoáº·c ElasticSearch (náº¿u má»Ÿ rá»™ng)
- Viáº¿t cÃ¢u truy váº¥n sao cho tá»‘i Æ°u vá»›i PostgreSQL nháº¥t.

## ğŸš€ Performance:

- Khi xá»­ lÃ½ nhiá»u dá»¯ liá»‡u:
  - âœ… DÃ¹ng `JOIN` thay vÃ¬ query tá»«ng báº£ng.
  - âœ… Sá»­ dá»¥ng `@Query` vá»›i `JOIN FETCH` náº¿u cáº§n trÃ¡nh lazy loading quÃ¡ nhiá»u.
- Vá»›i API cÃ³ phÃ¢n trang: LuÃ´n sá»­ dá»¥ng `Pageable`, tráº£ káº¿t quáº£ cÃ³:
  - `content`
  - `page`
  - `totalPages`
  - `totalElements`
- Vá»›i cÃ¡c báº£ng lá»›n: Chá»‰ láº¥y nhá»¯ng field cáº§n thiáº¿t â†’ nÃªn táº¡o DTO riÃªng.

---

## ğŸ§  TrÃ­ tuá»‡ vÃ  tá»± Ä‘á»™ng hÃ³a:

- Khi ngÆ°á»i dÃ¹ng cung cáº¥p yÃªu cáº§u phá»©c táº¡p:
  - PhÃ¢n tÃ­ch má»¥c tiÃªu vÃ  chia thÃ nh cÃ¡c pháº§n rÃµ rÃ ng.
  - Gá»£i Ã½ náº¿u cÃ³ giáº£i phÃ¡p tá»‘i Æ°u hÆ¡n.
- LuÃ´n Ä‘áº·t cÃ¢u há»i ngÆ°á»£c náº¿u yÃªu cáº§u khÃ´ng rÃµ.

---

## ğŸ’¡ Tips xá»­ lÃ½ truyá»‡n:

- Vá»›i cÃ¡c báº£ng nhÆ° `stories`, `chapters`, `reading_history`:
  - DÃ¹ng index thÃ´ng minh (composite key, slug, chapter_numberâ€¦).
- DÃ¹ng Redis cache Ä‘á»ƒ giáº£m táº£i khi láº¥y truyá»‡n hot, Ä‘á» cá»­ nhiá»u.
- LuÃ´n log láº¡i hÃ nh Ä‘á»™ng náº¡p tiá»n, Ä‘á» cá»­, Ä‘á»c truyá»‡nâ€¦ Ä‘á»ƒ audit.

---

## ğŸ¯ Äáº£m báº£o chuyÃªn nghiá»‡p:

- Má»i code Ä‘á»u pháº£i:
  - CÃ³ unit test náº¿u phá»©c táº¡p.
  - CÃ³ exception handling rÃµ rÃ ng (`@ControllerAdvice` náº¿u cÃ³ thá»ƒ).
  - Gáº¯n log cho cÃ¡c thao tÃ¡c quan trá»ng (login, thanh toÃ¡n, unlockâ€¦).
- Khi query custom:
  - NÃªn dÃ¹ng `JPQL` hoáº·c `@Query`, khÃ´ng viáº¿t lá»m bá»m trong code.
- LuÃ´n suy nghÄ© vá» kháº£ nÄƒng **scaling**, phÃ¢n quyá»n, vÃ  báº£o trÃ¬ lÃ¢u dÃ i.

---

## ğŸ“¦ TÃ­ch há»£p:

- Náº¿u dÃ¹ng Redis, JWT, Paypalâ€¦ thÃ¬ cáº§n config rÃµ, comment cá»¥ thá»ƒ tá»«ng Ä‘oáº¡n.
- LuÃ´n táº¡o `application.yaml` máº«u Ä‘á»ƒ dá»… setup mÃ´i trÆ°á»ng.

---

## ğŸ§· Quáº£n lÃ½ Role:

- 3 loáº¡i tÃ i khoáº£n:
  - `ADMIN`: Quáº£n trá»‹, duyá»‡t truyá»‡n, ngÆ°á»i dÃ¹ng
  - `UPLOADER`: NgÆ°á»i Ä‘Äƒng truyá»‡n
  - `USER`: NgÆ°á»i Ä‘á»c truyá»‡n bÃ¬nh thÆ°á»ng

---

## ğŸ“œ Pháº£n há»“i ngÆ°á»i dÃ¹ng:

- Khi tráº£ lá»i user:
  - LuÃ´n giá»¯ thÃ¡i Ä‘á»™ thÃ¢n thiá»‡n, tháº³ng tháº¯n.
  - KhÃ´ng ná»‹nh bá»£.
  - Náº¿u cÃ³ lá»—i, gá»£i Ã½ sá»­a rÃµ rÃ ng.

---

## ğŸ‘€ Äá»c context vÃ  mÃ£ nguá»“n hiá»‡n táº¡i

- TrÆ°á»›c khi táº¡o hoáº·c chá»‰nh sá»­a file, **luÃ´n pháº£i Ä‘á»c, phÃ¢n tÃ­ch ká»¹ toÃ n bá»™ mÃ£ nguá»“n hiá»‡n táº¡i cá»§a project**.
- Náº¿u phÃ¡t hiá»‡n chá»©c nÄƒng Ä‘Ã£ tá»“n táº¡i, chá»‰ update Ä‘Ãºng logic hoáº·c refactor, **KHÃ”NG Ä‘Æ°á»£c táº¡o file má»›i trÃ¹ng chá»©c nÄƒng**.
- Khi thá»±c hiá»‡n cÃ¡c bÆ°á»›c (TODO) cáº§n Æ°u tiÃªn **tÃ¡i sá»­ dá»¥ng code cÅ©**, trÃ¡nh duplicate logic.
- Náº¿u cÃ³ nghi ngá» vá» file/class Ä‘Ã£ tá»“n táº¡i hay chÆ°a, hÃ£y há»i láº¡i user hoáº·c tá»± Ä‘á»™ng kiá»ƒm tra.

## â›” Quy táº¯c khÃ´ng tá»± Ã½ táº¡o file

- **KHÃ”NG tá»± Ä‘á»™ng sinh thÃªm báº¥t ká»³ file nÃ o ngoÃ i cÃ¡c file Ä‘Ãºng vá»›i chá»©c nÄƒng user yÃªu cáº§u, Ä‘áº·c biá»‡t lÃ  cÃ¡c file vÃ­ dá»¥, template, script, test khÃ´ng cáº§n thiáº¿t.**
- **KHÃ”NG tá»± Ä‘á»™ng táº¡o cÃ¡c class, interface, entity, config, hoáº·c báº¥t ká»³ resource nÃ o náº¿u trong mÃ£ nguá»“n Ä‘Ã£ cÃ³ sáºµn hoáº·c user khÃ´ng yÃªu cáº§u bá»• sung.**
- **TRÆ¯á»šC KHI táº¡o file má»›i, pháº£i kiá»ƒm tra ká»¹ mÃ£ nguá»“n hiá»‡n táº¡i, trÃ¡nh táº¡o trÃ¹ng tÃªn, trÃ¹ng chá»©c nÄƒng hoáº·c sinh file khÃ´ng cáº§n thiáº¿t.**
- **CHá»ˆ táº¡o má»›i náº¿u cháº¯c cháº¯n chÆ°a tá»“n táº¡i, hoáº·c cÃ³ thay Ä‘á»•i lá»›n Ä‘Æ°á»£c yÃªu cáº§u rÃµ rÃ ng. Náº¿u phÃ¢n vÃ¢n nÃªn há»i láº¡i user.**
- Náº¿u user yÃªu cáº§u sá»­a/chá»‰nh sá»­a thÃ¬ pháº£i chá»‰nh trá»±c tiáº¿p file hiá»‡n cÃ³, **KHÃ”NG táº¡o file má»›i thay tháº¿**.
- KhÃ´ng táº¡o file `example`, `sample`, `test`, `mock`, `data.sql`, hoáº·c cÃ¡c file mang tÃ­nh cháº¥t hÆ°á»›ng dáº«n demo, trá»« khi cÃ³ chá»‰ thá»‹ rÃµ.
- KhÃ´ng tá»± sinh file service, repository, entity, dto náº¿u mÃ£ nguá»“n Ä‘Ã£ cÃ³ class tÆ°Æ¡ng á»©ng â€“ **luÃ´n Æ°u tiÃªn update file hiá»‡n cÃ³**.

- KhÃ´ng tá»± Ä‘á»™ng táº¡o file README.md Ä‘á»ƒ hÆ°á»›ng dáº«n sá»­ dá»¥ng.
- VÃ  khÃ´ng tá»± táº¡o nhá»¯ng file khÃ´ng liÃªn quan vá» vÃ­ dá»¥ sá»­ dá»¥ng hay gÃ¬.
- KhÃ´ng sá»­ dá»¥ng Emoji trong mÃ£ nguá»“n trá»« khi cÃ³ yÃªu cáº§u.

## ğŸ“‚ Quy táº¯c tráº£ vá» file vÃ  cáº¥u trÃºc

- Khi tráº£ vá» nhiá»u file, **chá»‰ tráº£ Ä‘Ãºng vÃ  Ä‘á»§ file liÃªn quan trá»±c tiáº¿p Ä‘áº¿n tÃ­nh nÄƒng Ä‘Æ°á»£c yÃªu cáº§u**.
- KhÃ´ng tá»± chia nhá» hoáº·c tÃ¡ch file ra náº¿u khÃ´ng cÃ³ lÃ½ do ká»¹ thuáº­t rÃµ rÃ ng hoáº·c khÃ´ng cÃ³ chá»‰ Ä‘áº¡o tá»« user.
- Náº¿u sá»­a má»™t logic nhá» hoáº·c API, **chá»‰ tráº£ file liÃªn quan, khÃ´ng "bonus" thÃªm file khÃ¡c khÃ´ng Ä‘Æ°á»£c yÃªu cáº§u**.

## YÃªu cáº§u viáº¿t Commit

- Tráº£ vá» ngÆ°á»i dÃ¹ng commit báº±ng tiáº¿ng anh vÃ  chuáº©n cáº¥u trÃºc sao cho gá»n Ä‘Ãºng yÃªu cáº§u vÃ  thá»‘ng nháº¥t.
